<!DOCTYPE html>
<html lang="es">
<head>
  <!-- 1. Meta tags -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GastoGo · Inicio</title>

  <!-- 2. Enlace a estilos externos -->
  <link rel="stylesheet" href="assets/css/style.css" />
</head>

<body>
  <!-- 3. Header -->
  <header class="header">
    <h1>GastoGo</h1>
  </header>

  <!-- 4. Contenedor principal -->
  <main class="main-content">
    <!-- 4.1. Tab Bar -->
    <nav class="tab-bar">
      <button type="button" class="tab-button active" data-tab="inicio">
        Inicio
      </button>
      <button type="button" class="tab-button" data-tab="gastos">
        Gastos
      </button>
      <button type="button" class="tab-button" data-tab="meses">
        Meses
      </button>
      <button type="button" class="tab-button" data-tab="tarjetas">
        Tarjetas
      </button>
      <button type="button" class="tab-button" data-tab="ajustes">
        Ajustes
      </button>
    </nav>

    <!-- 4.2. Sección “Inicio” -->
    <section id="inicio" class="tab-content active">
      <h2>Registrar Ingresos</h2>

      <!-- Ingreso principal -->
      <div class="card ingreso-principal">
        <label for="ingreso-principal-input">Ingreso mensual principal:</label>
        <input
          type="number"
          id="ingreso-principal-input"
          placeholder="Ej. 50000"
          min="0"
          value="0"
        />
        <button type="button" id="btn-guardar-principal" class="btn">
          Guardar Ingreso Principal
        </button>
      </div>

      <!-- Ingresos extras (oculto hasta guardar principal) -->
      <div class="card ingresos-extras" id="contenido-ingresos-extras" hidden>
        <h3>Ingresos Extras</h3>
        <button type="button" id="btn-mostrar-formulario-extra" class="btn-secundario">
          + Agregar Ingreso Extra
        </button>

        <form id="formulario-ingreso-extra" class="form-inline" hidden>
          <div class="form-group">
            <label for="desc-ingreso-extra">Descripción:</label>
            <input
              type="text"
              id="desc-ingreso-extra"
              placeholder="Ej. Freelance"
            />
          </div>
          <div class="form-group">
            <label for="monto-ingreso-extra">Monto:</label>
            <input
              type="number"
              id="monto-ingreso-extra"
              placeholder="Ej. 2000"
              min="0"
              value="0"
            />
          </div>
          <button type="button" id="btn-guardar-extra" class="btn">
            Guardar Extra
          </button>
        </form>

        <ul id="lista-ingresos-extras" class="lista-items">
          <!-- Aquí se irán agregando los <li> de cada extra -->
        </ul>
      </div>

      <!-- Saldo total disponible -->
      <div class="card saldo-total">
        <p>Saldo total disponible:</p>
        <p id="display-saldo-total">$0,00</p>
      </div>
    </section>

    <!-- 4.3. Sección “Gastos” -->
    <section id="gastos" class="tab-content">
      <h2>Registrar Gastos</h2>

      <!-- 4.3.1. Saldo Restante -->
      <div class="card saldo-restante">
        <p>Saldo restante:</p>
        <p id="display-saldo-restante">$0,00</p>
      </div>

      <!-- 4.3.2. Formulario para registrar un gasto -->
      <div class="card gasto-form">
        <div class="form-group">
          <label for="select-categoria">Categoría:</label>
          <select id="select-categoria">
            <option value="" selected>-- Seleccionar Categoría --</option>
            <option value="Alimentos">Alimentos</option>
            <option value="Transporte">Transporte</option>
            <option value="Salud">Salud</option>
            <option value="Entretenimiento">Entretenimiento</option>
            <!-- Agrega más categorías si las necesitas -->
          </select>
        </div>

        <div class="form-group">
          <label for="select-subcategoria">Subcategoría:</label>
          <select id="select-subcategoria" disabled>
            <option value="" selected>-- Seleccionar --</option>
            <!-- Las opciones se cargarán dinámicamente -->
          </select>
        </div>

        <div class="form-group">
          <label for="input-monto-gasto">Monto:</label>
          <input
            type="number"
            id="input-monto-gasto"
            placeholder="Ej. 500"
            min="0"
            value="0"
          />
        </div>

        <button type="button" id="btn-guardar-gasto" class="btn" disabled>
          Guardar Gasto
        </button>
      </div>

      <!-- 4.3.3. Historial de Gastos (tabla) -->
      <div class="card historial-gastos">
        <h3>Historial de Gastos</h3>
        <table id="tabla-gastos">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Categoría</th>
              <th>Subcategoría</th>
              <th>Monto</th>
              <th>Acción</th>
            </tr>
          </thead>
          <tbody>
            <!-- Aquí se añadirán las filas de cada gasto -->
          </tbody>
        </table>
      </div>

      <!-- 4.3.4. Botón “Finalizar Mes” (sticky en móvil) -->
      <button type="button" id="btn-finalizar-mes" class="btn finaliza-mes" disabled>
        Finalizar Mes
      </button>
    </section>

    <!-- 4.4. Sección “Meses” -->
    <section id="meses" class="tab-content">
      <h2>Historial de Meses Finalizados</h2>

      <!-- 4.4.1. Mensaje alternativo si no hay meses -->
      <p id="mensaje-sin-meses" class="mensaje-vacio">
        Aún no has finalizado ningún mes.
      </p>

      <!-- 4.4.2. Tabla de meses finalizados -->
      <div class="card meses-tabla" id="contenedor-meses-tabla" hidden>
        <table id="tabla-meses">
          <thead>
            <tr>
              <th>Mes</th>
              <th>Ingresos</th>
              <th>Gastos</th>
              <th>Saldo Final</th>
            </tr>
          </thead>
          <tbody>
            <!-- Aquí se agregarán filas de meses dinámicamente -->
          </tbody>
        </table>
      </div>
    </section>
        <!-- 4.5. Sección “Tarjetas” -->
    <section id="tarjetas" class="tab-content">
  <h2>Gestión de Tarjetas</h2>

  <!-- 4.5.1. Formulario para agregar tarjeta -->
  <div class="card tarjeta-form">
    <div class="form-group">
      <label for="input-entidad-tarjeta">Entidad bancaria:</label>
      <input type="text" id="input-entidad-tarjeta" placeholder="Ej. Naranja" />
    </div>
    <div class="form-group">
      <label for="input-alias-tarjeta">Alias de la tarjeta:</label>
      <input type="text" id="input-alias-tarjeta" placeholder="Ej. VISA Trabajo" />
    </div>
    <div class="form-group">
      <label for="input-dia-cierre">Día de cierre (1–28):</label>
      <input type="number" id="input-dia-cierre" min="1" max="28" placeholder="Ej. 25" />
    </div>
    <button type="button" id="btn-guardar-tarjeta" class="btn" disabled>
      Guardar Tarjeta
    </button>
  </div>

  <!-- 4.5.2. Lista de tarjetas guardadas -->
  <div class="card lista-tarjetas">
    <h3>Tarjetas Guardadas</h3>
    <ul id="ul-tarjetas" class="lista-items">
      <!-- -> Cada <li> tendrá: Alias (Entidad), Día cierre, Resumen de ciclo, Resumen próximo ciclo, [Tarjeta pagada], [Eliminar] -->
    </ul>
  </div>

  <!-- 4.5.3. Formulario para registrar un gasto en tarjeta -->
  <div class="card gasto-tarjeta-form">
    <h3>Registrar Gasto en Tarjeta</h3>
    <div class="form-group">
      <label for="select-tarjeta-gasto">Tarjeta:</label>
      <select id="select-tarjeta-gasto">
        <option value="">-- Seleccionar Tarjeta --</option>
      </select>
    </div>
    <div class="form-group">
      <label for="input-fecha-compra">Fecha de compra:</label>
      <input type="date" id="input-fecha-compra" />
    </div>
    <div class="form-group">
      <label for="input-monto-gasto-tarjeta">Monto total:</label>
      <input type="number" id="input-monto-gasto-tarjeta" min="0" value="0" />
    </div>
    <div class="form-group">
      <label for="input-detalle-gasto">Detalle:</label>
      <input type="text" id="input-detalle-gasto" placeholder="Ej. Supermercado XYZ" />
    </div>
    <div class="form-group">
      <label for="input-cuotas-gasto">Cuotas:</label>
      <input
        type="number"
        id="input-cuotas-gasto"
        min="1"
        max="18"
        value="1"
     />

    </div>
    <button type="button" id="btn-guardar-gasto-tarjeta" class="btn" disabled>
      Guardar Gasto
    </button>
  </div>

  <!-- 4.5.4. Tabla de gastos por cuotas -->
  <div class="card tabla-gastos-tarjeta">
    <h3>Gastos y Cuotas</h3>
    <table id="tabla-gastos-tarjeta">
      <thead>
        <tr>
          <th>Fecha compra</th>
          <th>Detalle</th>
          <th>Cuotas</th>
          <th>Monto cuota</th>
          <th>Fecha primer venc.</th>
          <th>Ciclo asignado</th>
          <th>Acción</th>
        </tr>
      </thead>
      <tbody>
        <!-- Aquí se insertarán las filas de cada cuota -->
      </tbody>
    </table>
  </div>

  <!-- 4.5.5. Resumen general de ciclos -->
  <div class="card resumen-tarjetas">
    <h3>Resumen de Ciclo</h3>
    <p id="label-total-ciclo">Total Ciclo Actual: $0,00</p>
    <p id="label-total-prox-ciclo">Total Próximo Ciclo: $0,00</p>
  </div>
    </section>         

   <!-- 4.6. Sección “Ajustes” -->
<section id="ajustes" class="tab-content">
  <h2>Ajustes de la App</h2>

  <!-- 4.6.1. Selector de Moneda -->
  <div class="card ajuste-item">
    <label for="select-moneda">Moneda:</label>
    <select id="select-moneda">
      <option value="ARS">Pesos (ARS)</option>
      <option value="USD">Dólares (USD)</option>
      <option value="EUR">Euros (EUR)</option>
    </select>
  </div>

  <!-- 4.6.2. Toggle Modo Claro/Oscuro -->
  <div class="card ajuste-item">
    <span>Modo:</span>
    <label class="switch">
      <input type="checkbox" id="toggle-modo-oscuro" />
      <span class="slider"></span>
    </label>
    <span id="label-modo">Claro</span>
  </div>

  <!-- 4.6.3. Exportar / Importar datos -->
  <div class="card ajuste-item">
    <button type="button" id="btn-exportar" class="btn">Exportar Datos</button>
    <button type="button" id="btn-importar" class="btn">Importar Datos</button>
    <input type="file" id="input-import-file" accept=".json" hidden />
  </div>

  <!-- 4.6.4. Versión de la App -->
  <div class="card ajuste-item version-app">
    <small>v1.0.0</small>
  </div>
</section>

  </main>

  <!-- 5. Script de Tab Switching + lógica de “Inicio” -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // -------- TAB SWITCHING --------
      const tabButtons = document.querySelectorAll('.tab-button');
      const tabContents = document.querySelectorAll('.tab-content');

      tabButtons.forEach((btn) => {
        btn.addEventListener('click', function () {
          // 1) Remover clase active de todos los botones
          tabButtons.forEach((b) => b.classList.remove('active'));
          // 2) Agregar clase active al botón clicado
          this.classList.add('active');
          // 3) Ocultar todas las secciones
          tabContents.forEach((sec) => sec.classList.remove('active'));
          // 4) Mostrar la sección cuyo id coincide con data-tab del botón
          const target = this.getAttribute('data-tab');
          document.getElementById(target).classList.add('active');
        });
      });
      // Inicial: ya está “Inicio” activo porque en el HTML aparece con class="tab-content active"

      // -------- LÓGICA DE “INICIO” (Ingresos + Ingresos Extras) --------

      // Referencias a elementos de “Inicio”
      const ingresoPrincipalInput = document.getElementById('ingreso-principal-input');
      const btnGuardarPrincipal = document.getElementById('btn-guardar-principal');
      const contenidoExtras = document.getElementById('contenido-ingresos-extras');
      const btnMostrarExtra = document.getElementById('btn-mostrar-formulario-extra');
      const formularioExtra = document.getElementById('formulario-ingreso-extra');
      const descExtraInput = document.getElementById('desc-ingreso-extra');
      const montoExtraInput = document.getElementById('monto-ingreso-extra');
      const btnGuardarExtra = document.getElementById('btn-guardar-extra');
      const listaExtras = document.getElementById('lista-ingresos-extras');
      const displaySaldoTotal = document.getElementById('display-saldo-total');

      // Variables internas para Ingresos
      let ingresoPrincipal = 0;
      let ingresosExtras = []; // Array de { id, descripcion, monto }
      let nextExtraId = 0;

      // Formatear número como moneda $X.XXX,XX
     // Función para formatear un número según la moneda seleccionada
function formatearMoneda(valor) {
  const m = localStorage.getItem('moneda') || 'ARS';
  let symbol, locale;
  switch (m) {
    case 'USD':
      symbol = 'US$'; locale = 'en-US'; break;
    case 'EUR':
      symbol = '€'; locale = 'de-DE'; break;
    default:
      symbol = '$'; locale = 'es-AR';
  }
  return symbol + valor.toLocaleString(locale, { minimumFractionDigits: 2 });
}


      // 1) Si ya hay totalIngresosActual en localStorage, cargamos estado inicial
      const ingresosGuardados = localStorage.getItem('totalIngresosActual');
      if (ingresosGuardados && parseFloat(ingresosGuardados) > 0) {
        ingresoPrincipal = parseFloat(ingresosGuardados);
        ingresoPrincipalInput.value = ingresoPrincipal;
        ingresoPrincipalInput.disabled = true;
        btnGuardarPrincipal.disabled = true;
        contenidoExtras.hidden = false;
        // Mostrar el saldo total recargado
        displaySaldoTotal.textContent = formatearMoneda(ingresoPrincipal);
      }

      // 2) Habilitar/Deshabilitar botón “Guardar Ingreso Principal”
      function toggleBtnGuardarPrincipal() {
        const v = parseFloat(ingresoPrincipalInput.value);
        btnGuardarPrincipal.disabled = isNaN(v) || v <= 0;
      }
      ingresoPrincipalInput.addEventListener('input', toggleBtnGuardarPrincipal);
      toggleBtnGuardarPrincipal();

      // 3) Al hacer clic en “Guardar Ingreso Principal”
      btnGuardarPrincipal.addEventListener('click', function () {
        ingresoPrincipal = parseFloat(ingresoPrincipalInput.value) || 0;
        if (ingresoPrincipal <= 0) {
          alert('Ingresa un monto válido para el ingreso principal.');
          return;
        }
        // Bloquear input y botón principal
        ingresoPrincipalInput.disabled = true;
        btnGuardarPrincipal.disabled = true;

        // Guardar en localStorage el ingreso principal (sin extras todavía)
        localStorage.setItem('totalIngresosActual', ingresoPrincipal);

        // Mostrar sección de ingresos extras
        contenidoExtras.hidden = false;

        // Actualizar el saldo total
        actualizarSaldoTotal();
      });

      // 4) Mostrar u ocultar formulario para Ingreso Extra
      let formularioMostrado = false;
      btnMostrarExtra.addEventListener('click', function () {
        formularioMostrado = !formularioMostrado;
        formularioExtra.hidden = !formularioMostrado;
        if (formularioMostrado) {
          descExtraInput.focus();
        } else {
          descExtraInput.value = '';
          montoExtraInput.value = 0;
        }
      });

      // 5) Habilitar/Deshabilitar botón “Guardar Extra”
      function toggleBtnGuardarExtra() {
        const desc = descExtraInput.value.trim();
        const m = parseFloat(montoExtraInput.value);
        btnGuardarExtra.disabled = desc === '' || isNaN(m) || m <= 0;
      }
      descExtraInput.addEventListener('input', toggleBtnGuardarExtra);
      montoExtraInput.addEventListener('input', toggleBtnGuardarExtra);
      toggleBtnGuardarExtra();

      // 6) Al hacer clic en “Guardar Extra”
      btnGuardarExtra.addEventListener('click', function () {
        const desc = descExtraInput.value.trim();
        const monto = parseFloat(montoExtraInput.value) || 0;
        if (desc === '' || monto <= 0) {
          alert('Completa descripción y monto válido para el ingreso extra.');
          return;
        }

        // Crear objeto extra y agregarlo al array
        const extra = { id: nextExtraId++, descripcion: desc, monto };
        ingresosExtras.push(extra);

        // Crear <li> en la lista de extras
        const li = document.createElement('li');
        li.className = 'item-extra';
        li.dataset.id = extra.id;
        li.innerHTML = `
          <span>${extra.descripcion}: ${formatearMoneda(extra.monto)}</span>
          <button type="button" class="btn-eliminar-extra">Eliminar</button>
        `;
        listaExtras.appendChild(li);

        // Limpiar formulario
        descExtraInput.value = '';
        montoExtraInput.value = 0;
        toggleBtnGuardarExtra();

        // Actualizar el saldo total (principal + extras)
        actualizarSaldoTotal();
      });

      // 7) Manejar clic en “Eliminar” de un ingreso extra
      listaExtras.addEventListener('click', function (e) {
        if (e.target.classList.contains('btn-eliminar-extra')) {
          const li = e.target.closest('li.item-extra');
          const id = parseInt(li.dataset.id);
          ingresosExtras = ingresosExtras.filter((extra) => extra.id !== id);
          listaExtras.removeChild(li);
          actualizarSaldoTotal();
        }
      });

      // 8) Función para calcular y mostrar el saldo total y guardarlo en localStorage
      function actualizarSaldoTotal() {
        const sumaExtras = ingresosExtras.reduce((acum, ex) => acum + ex.monto, 0);
        const saldo = ingresoPrincipal + sumaExtras;
        displaySaldoTotal.textContent = formatearMoneda(saldo);

        // Guardar el total (principal + extras) en localStorage
        localStorage.setItem('totalIngresosActual', saldo);
      }

      // 9) Mostrar el saldo inicial en pantalla (por si recargamos con ingresos guardados)
      const saldoRecargado = parseFloat(localStorage.getItem('totalIngresosActual')) || 0;
      if (saldoRecargado > 0) {
        displaySaldoTotal.textContent = formatearMoneda(saldoRecargado);
      }
    });
  </script>

  <!-- Enlazamos la lógica de Ajustes -->
  <script src="assets/js/ajustes.js"></script>
  <!-- Enlazamos la lógica de Gastos -->
  <script src="assets/js/gastos.js"></script>
  <!-- Enlazamos la lógica de Meses -->
  <script src="assets/js/meses.js"></script>
  <!-- Lógica de Tarjetas -->
  <script src="assets/js/tarjetas.js"></script>
</body>
</html>
