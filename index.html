<!DOCTYPE html>
<html lang="es">
<head>
  <!-- 1. Meta tags -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GastoGo · Inicio</title>

  <!-- 2. Enlace a estilos externos -->
  <link rel="stylesheet" href="assets/css/style.css" />
</head>

<body>
  <!-- 3. Header -->
  <header class="header">
    <h1>GastoGo</h1>
  </header>

  <!-- 4. Contenedor principal -->
  <main class="main-content">
    <!-- 4.1. Tab Bar -->
    <nav class="tab-bar">
      <button type="button" class="tab-button active" data-tab="inicio">
        Inicio
      </button>
      <button type="button" class="tab-button" data-tab="gastos">
        Gastos
      </button>
      <button type="button" class="tab-button" data-tab="meses">
        Meses
      </button>
      <button type="button" class="tab-button" data-tab="tarjetas">
        Tarjetas
      </button>
      <button type="button" class="tab-button" data-tab="ajustes">
        Ajustes
      </button>
    </nav>

    <!-- 4.2. Sección “Inicio” -->
    <section id="inicio" class="tab-content active">
      <h2>Registrar Ingresos</h2>

      <!-- Ingreso principal -->
      <div class="card ingreso-principal">
        <label for="ingreso-principal-input">Ingreso mensual principal:</label>
        <input
          type="number"
          id="ingreso-principal-input"
          placeholder="Ej. 50000"
          min="0"
          value="0"
        />
        <button type="button" id="btn-guardar-principal" class="btn">
          Guardar Ingreso Principal
        </button>
      </div>

      <!-- Ingresos extras (oculto hasta guardar principal) -->
      <div class="card ingresos-extras" id="contenido-ingresos-extras" hidden>
        <h3>Ingresos Extras</h3>
        <button type="button" id="btn-mostrar-formulario-extra" class="btn-secundario">
          + Agregar Ingreso Extra
        </button>

        <form id="formulario-ingreso-extra" class="form-inline" hidden>
          <div class="form-group">
            <label for="desc-ingreso-extra">Descripción:</label>
            <input
              type="text"
              id="desc-ingreso-extra"
              placeholder="Ej. Freelance"
            />
          </div>
          <div class="form-group">
            <label for="monto-ingreso-extra">Monto:</label>
            <input
              type="number"
              id="monto-ingreso-extra"
              placeholder="Ej. 2000"
              min="0"
              value="0"
            />
          </div>
          <button type="button" id="btn-guardar-extra" class="btn">
            Guardar Extra
          </button>
        </form>

        <ul id="lista-ingresos-extras" class="lista-items">
          <!-- Aquí se irán agregando los <li> de cada extra -->
        </ul>
      </div>

      <!-- Saldo total disponible -->
      <div class="card saldo-total">
        <p>Saldo total disponible:</p>
        <p id="display-saldo-total">$0,00</p>
      </div>
    </section>

    <!-- 4.3. Placeholder para “Gastos” -->
    <section id="gastos" class="tab-content">
      <!-- Aquí irá el formulario de gastos en el próximo paso -->
    </section>

    <!-- 4.4. Placeholder para “Meses” -->
    <section id="meses" class="tab-content">
      <!-- Aquí irá el historial de meses finalizados -->
    </section>

    <!-- 4.5. Placeholder para “Tarjetas” -->
    <section id="tarjetas" class="tab-content">
      <!-- Aquí gestionaremos las tarjetas de crédito -->
    </section>

    <!-- 4.6. Placeholder para “Ajustes” -->
    <section id="ajustes" class="tab-content">
      <!-- Aquí irán los ajustes de configuración -->
    </section>
  </main>

  <!-- 5. Script de Tab Switching + lógica de “Inicio” -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // 5.1. TAB SWITCHING: mostrar/ocultar secciones según data-tab
      const tabButtons = document.querySelectorAll('.tab-button');
      const tabContents = document.querySelectorAll('.tab-content');

      tabButtons.forEach((btn) => {
        btn.addEventListener('click', function () {
          // 1) Remover clase active de todos los botones
          tabButtons.forEach((b) => b.classList.remove('active'));
          // 2) Agregar clase active al botón clicado
          this.classList.add('active');
          // 3) Ocultar todas las secciones
          tabContents.forEach((sec) => sec.classList.remove('active'));
          // 4) Mostrar la sección cuyo id coincide con data-tab del botón
          const target = this.getAttribute('data-tab');
          document.getElementById(target).classList.add('active');
        });
      });

      // 5.2. LÓGICA DE “INICIO” (Ingresos + Ingresos Extras)

      // Referencias a elementos
      const ingresoPrincipalInput = document.getElementById('ingreso-principal-input');
      const btnGuardarPrincipal = document.getElementById('btn-guardar-principal');
      const contenidoExtras = document.getElementById('contenido-ingresos-extras');
      const btnMostrarExtra = document.getElementById('btn-mostrar-formulario-extra');
      const formularioExtra = document.getElementById('formulario-ingreso-extra');
      const descExtraInput = document.getElementById('desc-ingreso-extra');
      const montoExtraInput = document.getElementById('monto-ingreso-extra');
      const btnGuardarExtra = document.getElementById('btn-guardar-extra');
      const listaExtras = document.getElementById('lista-ingresos-extras');
      const displaySaldoTotal = document.getElementById('display-saldo-total');

      // Variables internas
      let ingresoPrincipal = 0;
      let ingresosExtras = []; // Array de { id, descripcion, monto }
      let nextExtraId = 0;

      // Formatear número como moneda $X.XXX,XX
      function formatearMoneda(valor) {
        return '$' + valor.toLocaleString('es-AR', { minimumFractionDigits: 2 });
      }

      // 1) Habilitar/Deshabilitar botón “Guardar Ingreso Principal”
      function toggleBtnGuardarPrincipal() {
        const v = parseFloat(ingresoPrincipalInput.value);
        btnGuardarPrincipal.disabled = isNaN(v) || v <= 0;
      }
      ingresoPrincipalInput.addEventListener('input', toggleBtnGuardarPrincipal);
      toggleBtnGuardarPrincipal();

      // 2) Al hacer clic en “Guardar Ingreso Principal”
      btnGuardarPrincipal.addEventListener('click', function () {
        ingresoPrincipal = parseFloat(ingresoPrincipalInput.value) || 0;
        if (ingresoPrincipal <= 0) {
          alert('Ingresa un monto válido para el ingreso principal.');
          return;
        }
        // Bloquear input y botón principal
        ingresoPrincipalInput.disabled = true;
        btnGuardarPrincipal.disabled = true;

        // Mostrar sección de ingresos extras
        contenidoExtras.hidden = false;

        // Actualizar saldo total
        actualizarSaldoTotal();
      });

      // 3) Mostrar u ocultar formulario para Ingreso Extra
      let formularioMostrado = false;
      btnMostrarExtra.addEventListener('click', function () {
        formularioMostrado = !formularioMostrado;
        formularioExtra.hidden = !formularioMostrado;
        if (formularioMostrado) {
          descExtraInput.focus();
        } else {
          descExtraInput.value = '';
          montoExtraInput.value = 0;
        }
      });

      // 4) Habilitar/Deshabilitar botón “Guardar Extra”
      function toggleBtnGuardarExtra() {
        const desc = descExtraInput.value.trim();
        const m = parseFloat(montoExtraInput.value);
        btnGuardarExtra.disabled = desc === '' || isNaN(m) || m <= 0;
      }
      descExtraInput.addEventListener('input', toggleBtnGuardarExtra);
      montoExtraInput.addEventListener('input', toggleBtnGuardarExtra);
      toggleBtnGuardarExtra();

      // 5) Al hacer clic en “Guardar Extra”
      btnGuardarExtra.addEventListener('click', function () {
        const desc = descExtraInput.value.trim();
        const monto = parseFloat(montoExtraInput.value) || 0;
        if (desc === '' || monto <= 0) {
          alert('Completa descripción y monto válido para el ingreso extra.');
          return;
        }

        // Crear objeto extra y agregarlo al array
        const extra = { id: nextExtraId++, descripcion: desc, monto };
        ingresosExtras.push(extra);

        // Crear <li> en la lista de extras
        const li = document.createElement('li');
        li.className = 'item-extra';
        li.dataset.id = extra.id;
        li.innerHTML = `
          <span>${extra.descripcion}: ${formatearMoneda(extra.monto)}</span>
          <button type="button" class="btn-eliminar-extra">Eliminar</button>
        `;
        listaExtras.appendChild(li);

        // Limpiar formulario
        descExtraInput.value = '';
        montoExtraInput.value = 0;
        toggleBtnGuardarExtra();

        // Actualizar saldo total
        actualizarSaldoTotal();
      });

      // 6) Manejar clic en “Eliminar” de un ingreso extra
      listaExtras.addEventListener('click', function (e) {
        if (e.target.classList.contains('btn-eliminar-extra')) {
          const li = e.target.closest('li.item-extra');
          const id = parseInt(li.dataset.id);
          ingresosExtras = ingresosExtras.filter((extra) => extra.id !== id);
          listaExtras.removeChild(li);
          actualizarSaldoTotal();
        }
      });

      // 7) Función para calcular y mostrar el saldo total
      function actualizarSaldoTotal() {
        const sumaExtras = ingresosExtras.reduce((acum, ex) => acum + ex.monto, 0);
        const saldo = ingresoPrincipal + sumaExtras;
        displaySaldoTotal.textContent = formatearMoneda(saldo);
      }
    });
  </script>
</body>
</html>
